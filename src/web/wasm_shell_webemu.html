<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <title>webemu</title>
    <meta name="viewport" content="width=device-width" />
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <div class="controll-bar">
      <input type="button" value="Load Memory and Program" id="prog_init" />
      Memory: <input type="text" size="3" id="mem_start" value="0x34" />--<input type="text" size="3" id="mem_end" value="0x40" /><input type="button" value="Set Range" id="set_range" />
      <input type="button" value="Reverse Next (←)" id="reverse_clock" />
      <input type="button" value="Next Clock (→)" id="clock" />
      <input type="button" value="Continue" id="continue" />
      <input type="button" value="Copy Assembled Program" id="copy_prog_mem" />
      <input type="button" value="Download Memory as C Source Code" id="download_mem_c" />
      <div class="error-bar" id="err"></div>
    </div>

    <div class="doc-notification">
      Documentation available (Japanese).
      <a href="https://www.kofuk.org/blog/20220131-emulator/">Visit</a>
    </div>

    <div class="container">
      <div class="source-pane pane">
        <form>
          <textarea id="prog" rows="15" placeholder="Program (Assembly)">
lli r0, 0x30 # first word
lli r1, 0x40 # last word

&#35; If you put "@foo" at the beginning of
&#35; line, you can refer to the position from
&#35; operands of jump/branch instructions.
@loop sw r2, (r0)
addi r0, 2
mov r3, r1
sub r3, r0
&#35; "@loop" is replaced with actual address
&#35; of "sw" instruction at line 7.
bnez r3, @loop
nop

&#35; You can use "@foo" address syntax to
&#35; jump to any position on the source code.
@dyn_stop j @dyn_stop
nop</textarea><br/>
          <textarea id="memfile" rows="15" placeholder="Contents of .mem file">
@30 00000001 00000010
@32 00000011 00000100
@34 00000101 00000110
@36 00000111 00001000
@38 00001001 00001010
@3a 00001011 00001100
@3c 00001101 00001110
@3e 00001111 00010000</textarea><br/>
        </form>
        <div>
          <a href="https://github.com/kofuk/exasm">View Source Code on GitHub</a>
        </div>
      </div>
      <div class="run-pane pane">
        <div id="status" class="status-bar"></div>

        <div>
          Estimated Clock Count: <span id="clock_count">0</span>
          <div class="tip">
            <strong>DISCLAIMER</strong>: The estimated clock may be inaccurate
            because the emulator doesn't run pipelined processing internally.
          </div>
        </div>

        <div>
          Register:
          <table border="1">
            <thead>
              <tr>
                <th>r0</th>
                <th>r1</th>
                <th>r2</th>
                <th>r3</th>
                <th>r4</th>
                <th>r5</th>
                <th>r6</th>
                <th>r7</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td><input type="text" size="3" id="reg0" /></td>
                <td><input type="text" size="3" id="reg1" /></td>
                <td><input type="text" size="3" id="reg2" /></td>
                <td><input type="text" size="3" id="reg3" /></td>
                <td><input type="text" size="3" id="reg4" /></td>
                <td><input type="text" size="3" id="reg5" /></td>
                <td><input type="text" size="3" id="reg6" /></td>
                <td><input type="text" size="3" id="reg7" /></td>
              </tr>
            </tbody>
          </table>
          <input type="button" value="Apply Changes" id="apply_reg" />
        </div>

        <div>
          Memory:
          <table border="1">
            <thead>
              <tr>
                <th></th>
                <th>x0<br>x8</th>
                <th>x1<br>x9</th>
                <th>x2<br>xa</th>
                <th>x3<br>xb</th>
                <th>x4<br>xc</th>
                <th>x5<br>xd</th>
                <th>x6<br>xe</th>
                <th>x7<br>xf</th>
              </tr>
            </thead>
            <tbody id="mem_table_body">
            </tbody>
          </table>
          <input type="button" value="Apply Changes" id="apply_mem" />
        </div>

        <div>
          Trace:
          <table border="1" class="trace-table">
            <thead>
              <tr>
                <th>Break</th>
                <th>Instruction</th>
              </tr>
            </thead>
            <tbody id="trace_body"></tbody>
          </table>
        </div>
      </div>
      <div class="breakpoint-pane pane">
        Breakpoints:
        <table border="1" class="breakpoint-table">
            <thead>
              <tr>
                <th></th>
                <th>Condition</th>
              </tr>
            </thead>
            <tbody id="breakpoint_table_body"></tbody>
        </table>
      </div>
    </div>

    <script>
     var Module = {
         preRun: [],
         postRun: [],
         print: function(text) {
             console.log(text);
         },
         printErr: function(text) {
             appendError(text);
         },
         setStatus: function(text) {
             if (text) console.log(text);
         },
     };
    </script>
    <script src="driver.js"></script>
    <script
	    src="https://code.jquery.com/jquery-3.6.0.slim.min.js"
	    integrity="sha256-u7e5khyithlIdTpu22PHhENmPcRdFiHRjhAuHcs05RI="
	    crossorigin="anonymous"></script>
    <script src="bcralnit.js"></script>
    <script>
     $('#prog').bcralnit({width: '35px'});
    </script>
    {{{ SCRIPT }}}
  </body>
</html>
